t5 - phantom testing. 
=================================================================

There are two separate questions which I am convoluting. 
1. How does what they are doing so far work? I seem to just get non-specfic spiking with or without US due to non-linearities in saline. Do some 80 Hz PRF tests with and without US. Do I see any difference in the broadband energy around the PRF? Do I see any difference in the harmonics generated by the applied electric field? 

2. Can I demodulate around something well understood but a bit tricky at 500kHz? What are the limits of what I can detect? How small? Can I improve this with the use of F21, now that I know about the kaiser window? By increasing the gain? If I can do this... I have a proper paper that isn't grovelling in confusing stuff. 


3. Low PRF test for electrical amplitudes. It is the envelope of the US which matters. Can I increase it's amplitude though with an electric field? Ideally I just need to apply the same pattern electric field. 
Can I increase the PRF amplitude at low frequencies by added current? The measurement reference electrode should be distant. the stim electrodes should be next to 

===
I set up electrode such that current was applied on either side of one measurement electrode, and I had a distant reference. The reference is not in the electric field, but the measurement electrode is. 

First calibrate position, using preamp at gain = 10 and 9khz electric field. 
I can see the AE effect clearly and beautifully. 
This time, the locus of the current is very small and reflects the small current monopole size. This is a better way to calibrate(tight current location). Found it - it is far above the SNR. 


Test 1: 
1. How does what they are doing so far work? I seem to just get non-specfic spiking with or without US due to non-linearities in saline. Do some 80 Hz PRF tests with and without US. Do I see any difference in the broadband energy around the PRF? Do I see any difference in the harmonics generated by the applied electric field? 

I can see lots of sub harmonics of the applied 10Hz. 
- Turn on the filters on the preamp, so I can try to up the gain. Otherwise the DC offset is far too large. 

- Gain = 100, 3hz high pass, 10k low pass. 80 Hz PRF. 24Hz applied field. 
- duration = 12s. Fs = 2MHz. 6000 microvolts at 24hz (HUGE). 30Hz band of interest. 

1-4 with pressure. 
5-8 without pressure. 
9-12 continuous wave, 24hz. 10k high pass here. 

TODO, demodulate around the center 500kHz band of these files, and compare to demodulating around 80Hz? Demodulating around 80Hz gives the smallest amplitude. 

For scale, if we applied the same field continuously, the amplitude of the sum and difference frequency is: 10k high pass. 
12 microvolts. So it is much bigger. I get a very clean demodulation with no sub-harmonics. 

To obtain the largest amplitude acoustoelectric interaction, we should use a continuous wave. To decrease sub-harmonics in our demodulation, we shouldn't use a PRF. Demodulating around the PRF works in that it does give a TINY amplitude mixing signal, but it is NOT significant compared to the spike demodulation effect. Hence any data which contains spikes in it(i.e. neural data) will not be accessible by demodulated around the PRF. 

END TEST 1. 

Test 2: How to detect small things around the continuous wave. 

1. Kaiser window beta = 20. 
   Applied field is 300 microvolts at the measurement 
2. At 30 microvolts (vout = 0.01), 24Hz. 12 second recording. I cannot see it. This is a fine sized VEP, but translates terribly into the acoustoelectric space. 
Also, at gain 500, without F21 shielding I am at 2v in height. 

Gain and F21: 
1. No F21. 30 microvolt signal. No filters. 
2. F21. 30 microvolt signal. The electrical signal is down to 83 microvolts. This means I can turn up the gain. Gain = 500. 
3. Gain = 1000. unclear. nothing there. 
4. Gain = 2000. I had to add in a high pass filter so the DC offset didn't OVLD anything. 3hz high pass. Moved to 300 microvolt signal to be able to see it. This is too big an amplitude. 

The signal disappeared because somehow things moved a mm or two, meaning I was off target. 
I recalibrated position. 

5. I took 20 recordings of 12 second duration, at 500 gain and F21 in place. The amplitude of the electric signal is about 300 microvolts. And still it is hard to see. Averaging appears to be less helpful than I originally thought? Is the signal NOT time synced? 
I think I might have some time alignment issues. TODO: check time alignment issues. 
THE SIGNALS ARE NOT TIME ALIGNED! CRAP. 

THIS IS A MASSIVE PROBLEM. This is also why my marker data always turns out better...
It would be nice to be able to do time alignment. 

I have adjusted some variables so they re-zero after each recording, hopefully this helps the LED alignment issue. 
However, I think I will still need to create a manual alignment script on files and add it in. I need files to be PERFECTLY aligned for this to work. 

TODO: 
I need to fix the skip one error - Done. This will help with the VEPs wholefile averaging.  
AND also add time alignment code. 
I think what I need to do is insert a marker into the generator file which I can then use to align with at the end. 
Where should this be? On the pressure channel, or on the voltage mon channel. 
Let's try the v mon channel. 

I have moved the pressure output onto channel 1. 
This means I could program a pressure channel marker tonight and test it. 

- I have now done this, and my SNR appears to be improving incrementally with each recording which is ideal. 
However, my LED alignment is not perfect. 
After 15 12 second recordings, I have an SNR of 35dB on a 36 microvolt signal. 
This IS good enough to do neural recording! 

However, my LED timing alignment is messed up. 
If I could fix it - that would be ideal. 

- It seems that I could use the voltage generator as an LED trigger? 
- When I am measuring from the mouse, I do not need that generator. 

TODO: 













